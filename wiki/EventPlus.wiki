= Stock Quote Analyzer =

Lets win half the battle by running through the use case below. Below example analyzes quotes from two stock exchanges and merges the quotes to figure out best bid and ask and computes PNL in realtime.
Below code is in lined from [http://event-plus.googlecode.com/svn/trunk/examples/StockQuoteAnalyzer StockQuoteAnalyzer].
So we begin by coding few interfaces as simple as below. 

{{{
package schema;

import processor.Quote;

import com.biswa.ep.annotations.EPAttrType;
import com.biswa.ep.annotations.EPAttribute;
import com.biswa.ep.annotations.EPConType;
import com.biswa.ep.annotations.EPContainer;
import com.biswa.ep.annotations.EPContext;
import com.biswa.ep.annotations.EPPublish;

@EPContext()
public interface StockQuoteAnalyzer {
	@EPContainer(type = EPConType.Subscription)
	public interface NYSE {
		@EPAttribute(type = EPAttrType.SubProcessor, processor = "processor.NYSEMarketData")
		Quote marketData = null; 
	}

	@EPContainer(type = EPConType.Subscription)
	public interface NASDAQ {
		@EPAttribute(type = EPAttrType.SubProcessor, processor = "processor.NASDAQMarketData")
		Quote marketData = null;
	}

	@EPContainer(generator = "generator.Portfolio")
	interface InputStocks {
		String symbol = null;
		Double quantity = null;
		Double tranPrice = null;
	}

	@EPContainer(publish=EPPublish.RMI)
	public interface Portfolio extends InputStocks {
		@EPAttribute(type = EPAttrType.Subscriber, depends = "symbol", container = "NYSE")
		public Quote nysePrice = null;
		
		@EPAttribute(type = EPAttrType.Subscriber, depends = "symbol", container = "NASDAQ")
		public Quote nasdaqPrice = null;
		
		public Double bestBid=nysePrice.bid>nasdaqPrice.bid?nysePrice.bid:nasdaqPrice.bid;
		public Double bestAsk=nysePrice.ask<nasdaqPrice.ask?nysePrice.ask:nasdaqPrice.ask;
		
		public Double stockWorth = quantity>0.0?quantity*bestBid:quantity*bestAsk;
		
		public Double PNL = stockWorth-quantity*tranPrice; 
	}
}

}}}

You must have noticed special annotations @EPContext and @EPContainer around the interfaces right? Yes that's where the magic begins. As we compile this interface just like as if any other standard java program Java compiler will generate special code wiring all the dependencies and deployment descriptors required to forward propagate the dependencies.

During compilation phase Java compiler will delegate all java files annotated with @EPContext to event plus library for special purpose processing and will go through further code generation and sub sequential compilation phases behind the curtain. During compilation compiler will also generate deployment descriptors to deploy the generated code.

{{{
See StockQuoteAnalyzer.xml below.

<?xml version='1.0'?>
<Context name='StockQuoteAnalyzer' xmlns='https://code.google.com/p/event-plus'>
	<Container type='Subscription' name='NYSE'>
		<Publish method='LOCAL' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$NYSE$marketData' />
	</Container>
	<Container type='Subscription' name='NASDAQ'>
		<Publish method='LOCAL' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$NASDAQ$marketData' />
	</Container>
	<Container type='Simple' name='InputStocks'>
		<Publish method='LOCAL' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$InputStocks$symbol' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$InputStocks$quantity' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$InputStocks$tranPrice' />
		<Source className='epimpl.schema.StockQuoteAnalyzer$InputStocks$Inlet' />
	</Container>
	<Container type='Simple' name='Portfolio'>
		<Publish method='RMI' />
		<Listen container='InputStocks' context='StockQuoteAnalyzer' method='LOCAL' transactionGroup='1' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$Portfolio$nysePrice' />
		<Listen container='NYSE' context='StockQuoteAnalyzer' method='LOCAL' transactionGroup='2' />
		<Feedback container='NYSE' context='StockQuoteAnalyzer' method='LOCAL' />
		<Subscribe container='NYSE' context='StockQuoteAnalyzer' method='LOCAL' depends='symbol' response='nysePrice' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$Portfolio$nasdaqPrice' />
		<Listen container='NASDAQ' context='StockQuoteAnalyzer' method='LOCAL' transactionGroup='4' />
		<Feedback container='NASDAQ' context='StockQuoteAnalyzer' method='LOCAL' />
		<Subscribe container='NASDAQ' context='StockQuoteAnalyzer' method='LOCAL' depends='symbol' response='nasdaqPrice' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$Portfolio$bestBid' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$Portfolio$bestAsk' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$Portfolio$stockWorth' />
		<Attribute className='epimpl.schema.StockQuoteAnalyzer$Portfolio$PNL' />
	</Container>
</Context>
}}}